# PFM - Authentication API

## Getting Started

Prerequisites:
- docker is up and running
- docker-compose is installed
- awscli is installed and configured

### Step 1: Start the dependencies

The docker compose will start: 
- a MySQL DB Server: Available on localhost,1433 or 192.168.99.100,1433 depending on your docker setup.
- Local Stack for secretsmanager used by PFM Authentication API

```bash
docker-compose up
```

### Step 2: Publish database

Right click on PFM.Authentication.Db and publish.

### Step 3: Add a secret salt for your user passwords

```
aws secretsmanager create-secret --name "pfm/pwdsalt" --description "Password Salt" --secret-string "{PasswordSalt: \"SOME SALT\"}" --endpoint http://localhost:4584 --region us-east-1
```

## Build pfm-authentication-api docker image

Prerequisites:
- have a repository where to store the docker image

### Step 1: Docker Build

```
docker build . -t jm89/pfm-authentication-api:api-latest
```

### Step 2: Docker Run

```
docker run -p 5000:5000 -e ASPNETCORE_URLS="http://+:5000" jm89/pfm-authentication-api:api-latest
```

And check that you can ping the API:

```
curl -kv http://localhost:5000
```

### Step 3: Docker Push

```
docker login --password "<password>" --username "jm89"
```

```
docker push jm89/pfm-authentication-api:api-latest 
```

## Work in progress

### Code Improvements

- [ ] Add Swagger Documentation

### Security

- [ ] Add monitoring on the AllowAnonymous methods

### Tests

- [ ] Add unit tests

## Functional Requirements

|Use Case| Name| Description|
|---|---|---|
|[U_01](https://github.com/JM89/personalfinancemanager/wiki/U_01---User-Registration)| User Registering|Register a new user so he can start to use the application|
|[U_02](https://github.com/JM89/personalfinancemanager/wiki/U_02---User-Authentication)| User Authentication|Be able to log in a user so he can start to use the application|
|A_01| API Registration | Be able to register and validate APIs  with protected API Keys |


### Available endpoints

#### User endpoints

```
POST http://localhost:4000/users/authenticate
{
	"username": "test",
	"password": "test"
}
```

```
POST http://localhost:4000/users/register
{
	"username": "jm89@pfm.com",
	"firstname": "firstname",
	"lastname": "lastname",
	"password": "securepassword"
}
```

```
GET http://localhost:4000/users/GetUserInfo
Authorization 'Bearer <token>'
```

#### ApiKey endpoints

```
POST http://localhost:4000/apikeys/validate
{
	"AppId": "6e16247f-d0f1-48d9-8f92-11623ae57dc9",
    	"AppName": "Bank Account API",
	"ApiKey":"<autogenerated-when-registering>"
}
```

```
POST http://localhost:4000/apikeys/register
{
	"AppId": "6a38d6d7-47a3-4fee-9614-35c28e8fc601"
}
```
